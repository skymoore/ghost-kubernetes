apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: skymoore-com

labels:
  - includeSelectors: true
    pairs:
      app: ghost

resources:
  - ../../base
  - certificate.yaml
  - ingress.yaml
  - serviceaccount.yaml
  - secrets.yaml
  - pvcs.yaml
  - gcs-pv.yml
  - gcs-pvc.yml

patches:
  - patch: |-
      apiVersion: v1
      kind: Secret
      metadata:
        name: ghost-secrets
      $patch: delete
  - path: db_deployment.yaml
  - path: ghost_deployment.yaml

images:
  - name: ghost-image
    newName: ghost
    newTag: 5-alpine
  - name: db-image
    newName: mysql
    newTag: "8"

configMapGenerator:
  - name: ghost-config
    behavior: merge
    envs:
      - "config/ghost.env"